(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))u(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&u(d)}).observe(document,{childList:!0,subtree:!0});function a(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function u(i){if(i.ep)return;i.ep=!0;const c=a(i);fetch(i.href,c)}})();function he(o){if(o.__esModule)return o;var s=o.default;if(typeof s=="function"){var a=function u(){if(this instanceof u){var i=[null];i.push.apply(i,arguments);var c=Function.bind.apply(s,i);return new c}return s.apply(this,arguments)};a.prototype=s.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(o).forEach(function(u){var i=Object.getOwnPropertyDescriptor(o,u);Object.defineProperty(a,u,i.get?i:{enumerable:!0,get:function(){return o[u]}})}),a}var ge={exports:{}};(function(o){var s=function(a){var u=Object.prototype,i=u.hasOwnProperty,c=Object.defineProperty||function(t,e,r){t[e]=r.value},d,y=typeof Symbol=="function"?Symbol:{},g=y.iterator||"@@iterator",j=y.asyncIterator||"@@asyncIterator",A=y.toStringTag||"@@toStringTag";function v(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{v({},"")}catch{v=function(e,r,f){return e[r]=f}}function z(t,e,r,f){var n=e&&e.prototype instanceof G?e:G,p=Object.create(n.prototype),E=new h(f||[]);return c(p,"_invoke",{value:te(t,r,E)}),p}a.wrap=z;function P(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(f){return{type:"throw",arg:f}}}var _="suspendedStart",Y="suspendedYield",$="executing",U="completed",b={};function G(){}function D(){}function R(){}var V={};v(V,g,function(){return this});var H=Object.getPrototypeOf,B=H&&H(H(w([])));B&&B!==u&&i.call(B,g)&&(V=B);var k=R.prototype=G.prototype=Object.create(V);D.prototype=R,c(k,"constructor",{value:R,configurable:!0}),c(R,"constructor",{value:D,configurable:!0}),D.displayName=v(R,A,"GeneratorFunction");function Z(t){["next","throw","return"].forEach(function(e){v(t,e,function(r){return this._invoke(e,r)})})}a.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===D||(e.displayName||e.name)==="GeneratorFunction":!1},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,R):(t.__proto__=R,v(t,A,"GeneratorFunction")),t.prototype=Object.create(k),t},a.awrap=function(t){return{__await:t}};function q(t,e){function r(p,E,L,O){var S=P(t[p],t,E);if(S.type==="throw")O(S.arg);else{var re=S.arg,J=re.value;return J&&typeof J=="object"&&i.call(J,"__await")?e.resolve(J.__await).then(function(C){r("next",C,L,O)},function(C){r("throw",C,L,O)}):e.resolve(J).then(function(C){re.value=C,L(re)},function(C){return r("throw",C,L,O)})}}var f;function n(p,E){function L(){return new e(function(O,S){r(p,E,O,S)})}return f=f?f.then(L,L):L()}c(this,"_invoke",{value:n})}Z(q.prototype),v(q.prototype,j,function(){return this}),a.AsyncIterator=q,a.async=function(t,e,r,f,n){n===void 0&&(n=Promise);var p=new q(z(t,e,r,f),n);return a.isGeneratorFunction(e)?p:p.next().then(function(E){return E.done?E.value:p.next()})};function te(t,e,r){var f=_;return function(p,E){if(f===$)throw new Error("Generator is already running");if(f===U){if(p==="throw")throw E;return F()}for(r.method=p,r.arg=E;;){var L=r.delegate;if(L){var O=Q(L,r);if(O){if(O===b)continue;return O}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(f===_)throw f=U,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);f=$;var S=P(t,e,r);if(S.type==="normal"){if(f=r.done?U:Y,S.arg===b)continue;return{value:S.arg,done:r.done}}else S.type==="throw"&&(f=U,r.method="throw",r.arg=S.arg)}}}function Q(t,e){var r=e.method,f=t.iterator[r];if(f===d)return e.delegate=null,r==="throw"&&t.iterator.return&&(e.method="return",e.arg=d,Q(t,e),e.method==="throw")||r!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var n=P(f,t.iterator,e.arg);if(n.type==="throw")return e.method="throw",e.arg=n.arg,e.delegate=null,b;var p=n.arg;if(!p)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,b;if(p.done)e[t.resultName]=p.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=d);else return p;return e.delegate=null,b}Z(k),v(k,A,"Generator"),v(k,g,function(){return this}),v(k,"toString",function(){return"[object Generator]"});function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function m(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}a.keys=function(t){var e=Object(t),r=[];for(var f in e)r.push(f);return r.reverse(),function n(){for(;r.length;){var p=r.pop();if(p in e)return n.value=p,n.done=!1,n}return n.done=!0,n}};function w(t){if(t){var e=t[g];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,f=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=d,n.done=!0,n};return f.next=f}}return{next:F}}a.values=w;function F(){return{value:d,done:!0}}return h.prototype={constructor:h,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(m),!t)for(var e in this)e.charAt(0)==="t"&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=d)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(O,S){return p.type="throw",p.arg=t,e.next=O,S&&(e.method="next",e.arg=d),!!S}for(var f=this.tryEntries.length-1;f>=0;--f){var n=this.tryEntries[f],p=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var E=i.call(n,"catchLoc"),L=i.call(n,"finallyLoc");if(E&&L){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(E){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else if(L){if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var f=this.tryEntries[r];if(f.tryLoc<=this.prev&&i.call(f,"finallyLoc")&&this.prev<f.finallyLoc){var n=f;break}}n&&(t==="break"||t==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var p=n?n.completion:{};return p.type=t,p.arg=e,n?(this.method="next",this.next=n.finallyLoc,b):this.complete(p)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),m(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var f=r.completion;if(f.type==="throw"){var n=f.arg;m(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:w(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=d),b}},a}(o.exports);try{regeneratorRuntime=s}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}})(ge);var be={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}},we=(o,s)=>{const a=o._malloc(s.length*Uint32Array.BYTES_PER_ELEMENT);return s.forEach((u,i)=>{const c=o.lengthBytesUTF8(u)+1,d=o._malloc(c);o.stringToUTF8(u,d,c),o.setValue(a+Uint32Array.BYTES_PER_ELEMENT*i,d,"i32")}),[s.length,a]};const ye="@ffmpeg/ffmpeg",ve="0.11.6",Fe="FFmpeg WebAssembly version",Ee="src/index.js",Le="src/index.d.ts",Se={example:"examples"},je={start:"node scripts/server.js","start:worker":"node scripts/worker-server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js","build:worker":"rimraf dist && webpack --config scripts/webpack.config.worker.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node node_modules/mocha/bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Oe={"./src/node/index.js":"./src/browser/index.js"},Pe={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},Re=["ffmpeg","WebAssembly","video"],Ae="Jerome Wu <jeromewus@gmail.com>",ke="MIT",_e={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},$e={node:">=12.16.1"},Ce="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Te={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Ne={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.11.0","@types/emscripten":"^1.39.4","babel-eslint":"^10.1.0","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"},de={name:ye,version:ve,description:Fe,main:Ee,types:Le,directories:Se,scripts:je,browser:Oe,repository:Pe,keywords:Re,author:Ae,license:ke,bugs:_e,engines:$e,homepage:Ce,dependencies:Te,devDependencies:Ne},Me=(typeof process<"u",`https://unpkg.com/@ffmpeg/core@${de.devDependencies["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`),Ue={corePath:Me};let ae=!1,pe=()=>{};const Ge=o=>{ae=o},De=o=>{pe=o},Be=(o,s)=>{pe({type:o,message:s}),ae&&console.log(`[${o}] ${s}`)};var N={logging:ae,setLogging:Ge,setCustomLogger:De,log:Be};const qe=o=>`
createFFmpegCore is not defined. ffmpeg.wasm is unable to find createFFmpegCore after loading ffmpeg-core.js from ${o}. Use another URL when calling createFFmpeg():

const ffmpeg = createFFmpeg({
  corePath: 'http://localhost:3000/ffmpeg-core.js',
});
`;var le={CREATE_FFMPEG_CORE_IS_NOT_DEFINED:qe};const I=async(o,s)=>{N.log("info",`fetch ${o}`);const a=await(await fetch(o)).arrayBuffer();N.log("info",`${o} file size = ${a.byteLength} bytes`);const u=new Blob([a],{type:s}),i=URL.createObjectURL(u);return N.log("info",`${o} blob URL = ${i}`),i},Ie=async({corePath:o,workerPath:s,wasmPath:a})=>{if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){if(typeof o!="string")throw Error("corePath should be a string!");const y=new URL(o,import.meta.url).href,g=await I(y,"application/javascript"),j=await I(a!==void 0?a:y.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),A=await I(s!==void 0?s:y.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(v=>{if(globalThis.importScripts(g),typeof createFFmpegCore>"u")throw Error(le.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(y));N.log("info","ffmpeg-core.js script loaded"),v({createFFmpegCore,corePath:g,wasmPath:j,workerPath:A})}):(N.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:g,wasmPath:j,workerPath:A}))}if(typeof o!="string")throw Error("corePath should be a string!");const u=new URL(o,import.meta.url).href,i=await I(u,"application/javascript"),c=await I(a!==void 0?a:u.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),d=await I(s!==void 0?s:u.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(y=>{const g=document.createElement("script"),j=()=>{if(g.removeEventListener("load",j),typeof createFFmpegCore>"u")throw Error(le.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(u));N.log("info","ffmpeg-core.js script loaded"),y({createFFmpegCore,corePath:i,wasmPath:c,workerPath:d})};g.src=i,g.type="text/javascript",g.addEventListener("load",j),document.getElementsByTagName("head")[0].appendChild(g)}):(N.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:i,wasmPath:c,workerPath:d}))},We=o=>new Promise((s,a)=>{const u=new FileReader;u.onload=()=>{s(u.result)},u.onerror=({target:{error:{code:i}}})=>{a(Error(`File could not be read! Code=${i}`))},u.readAsArrayBuffer(o)}),xe=async o=>{let s=o;return typeof o>"u"?new Uint8Array:(typeof o=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?s=atob(o.split(",")[1]).split("").map(a=>a.charCodeAt(0)):s=await(await fetch(new URL(o,import.meta.url).href)).arrayBuffer():(o instanceof File||o instanceof Blob)&&(s=await We(o)),new Uint8Array(s))},ze=Object.freeze(Object.defineProperty({__proto__:null,defaultOptions:Ue,fetchFile:xe,getCreateFFmpegCore:Ie},Symbol.toStringTag,{value:"Module"})),me=he(ze),{defaultArgs:Ye,baseOptions:Ve}=be,He=we,{defaultOptions:Je,getCreateFFmpegCore:Ke}=me,{version:Ze}=de,oe=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var Qe=(o={})=>{const{log:s,logger:a,progress:u,...i}={...Ve,...Je,...o};let c=null,d=null,y=null,g=null,j=!1,A=()=>{},v=s,z=u,P=0,_=0,Y=!1,$=0;const U=l=>{l==="FFMPEG_END"&&y!==null&&(y(),y=null,g=null,j=!1)},b=(l,m)=>{A({type:l,message:m}),v&&console.log(`[${l}] ${m}`)},G=l=>{const[m,h,w]=l.split(":");return parseFloat(m)*60*60+parseFloat(h)*60+parseFloat(w)},D=(l,m)=>{if(typeof l=="string")if(l.startsWith("  Duration")){const h=l.split(", ")[0].split(": ")[1],w=G(h);m({duration:w,ratio:$}),(P===0||P>w)&&(P=w,Y=!0)}else if(Y&&l.startsWith("    Stream")){const h=l.match(/([\d.]+) fps/);if(h){const w=parseFloat(h[1]);_=P*w}else _=0;Y=!1}else if(l.startsWith("frame")||l.startsWith("size")){const h=l.split("time=")[1].split(" ")[0],w=G(h),F=l.match(/frame=\s*(\d+)/);if(_&&F){const t=parseFloat(F[1]);$=Math.min(t/_,1)}else $=w/P;m({ratio:$,time:w})}else l.startsWith("video:")&&(m({ratio:1}),P=0)},R=({type:l,message:m})=>{b(l,m),D(m,z),U(m)},V=async()=>{if(b("info","load ffmpeg-core"),c===null){b("info","loading ffmpeg-core");const{createFFmpegCore:l,corePath:m,workerPath:h,wasmPath:w}=await Ke(i);c=await l({mainScriptUrlOrBlob:m,printErr:F=>R({type:"fferr",message:F}),print:F=>R({type:"ffout",message:F}),locateFile:(F,t)=>{if(typeof window<"u"||typeof WorkerGlobalScope<"u"){if(typeof w<"u"&&F.endsWith("ffmpeg-core.wasm"))return w;if(typeof h<"u"&&F.endsWith("ffmpeg-core.worker.js"))return h}return t+F}}),d=c.cwrap(i.mainName||"proxy_main","number",["number","number"]),b("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},H=()=>c!==null,B=(...l)=>{if(b("info",`run ffmpeg command: ${l.join(" ")}`),c===null)throw oe;if(j)throw Error("ffmpeg.wasm can only run one command at a time");return j=!0,new Promise((m,h)=>{const w=[...Ye,...l].filter(F=>F.length!==0);y=m,g=h,d(...He(c,w))})},k=(l,...m)=>{if(b("info",`run FS.${l} ${m.map(h=>typeof h=="string"?h:`<${h.length} bytes binary file>`).join(" ")}`),c===null)throw oe;{let h=null;try{h=c.FS[l](...m)}catch{throw Error(l==="readdir"?`ffmpeg.FS('readdir', '${m[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:l==="readFile"?`ffmpeg.FS('readFile', '${m[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return h}},Z=()=>{if(c===null)throw oe;g&&g("ffmpeg has exited"),j=!1;try{c.exit(1)}catch(l){b(l.message),g&&g(l)}finally{c=null,d=null,y=null,g=null}},q=l=>{z=l},te=l=>{A=l},Q=l=>{v=l};return b("info",`use ffmpeg.wasm v${Ze}`),{setProgress:q,setLogger:te,setLogging:Q,load:V,isLoaded:H,run:B,exit:Z,FS:k}};const Xe=Qe,{fetchFile:et}=me;var ie={createFFmpeg:Xe,fetchFile:et};const X=document.querySelector("#btn-start-record"),se=document.querySelector("#btn-stop-record"),ee=document.querySelector("#btn-merge"),ce=document.querySelector("#btn-preview"),fe=document.querySelector("#btn-download-video"),ue=document.querySelector("#btn-download-audio"),tt=document.querySelector("#btn-download-merge"),rt=document.querySelector("#btn-download-more"),M=document.querySelector("#my-recording"),x=document.querySelector("#my-audio");let ne=!1,W,T;const K=ie.createFFmpeg({log:!0}),ot=async()=>{await K.load(),X.removeAttribute("disabled"),se.setAttribute("disabled","disabled"),ee.setAttribute("disabled","disabled"),ce.setAttribute("disabled","disabled")};X.addEventListener("click",async o=>{let s=!0;if(M.src&&(s=confirm("Starting a new recording will overwrite your existing video and audio, are you sure you want to continue?")),s)try{const a=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0}),u=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:"screen"},audio:{sampleRate:44100},surfaceSwitching:"include",selfBrowserSurface:"exclude",systemAudio:"include"});X.setAttribute("disabled","disabled");const i=[];W=new MediaRecorder(u);const c=[];T=new MediaRecorder(a),W.ondataavailable=d=>{i.push(d.data)},T.ondataavailable=d=>{c.push(d.data)},W.start(),T.start(),setTimeout(()=>{W.stop(),T.stop()},1e4),W.onstop=()=>{T.stop(),M.src=URL.createObjectURL(new Blob(i,{type:i[0].type})),fe.href=M.src},T.onstop=()=>{x.src=URL.createObjectURL(new Blob(c,{type:c[0].type})),ue.href=x.src,ee.removeAttribute("disabled"),X.removeAttribute("disabled"),ce.removeAttribute("disabled"),rt.removeAttribute("disabled"),ue.setAttribute("aria-disabled","false"),fe.setAttribute("aria-disabled","false")},se.removeAttribute("disabled")}catch(a){console.error(a)}});ee.addEventListener("click",async o=>{K.FS("writeFile","video.webm",await ie.fetchFile(M.src)),K.FS("writeFile","audio.ogg",await ie.fetchFile(x.src)),await K.run("-i","video.webm","-i","audio.ogg","-c:v","libx264","-c:a","copy","output.mp4");const s=K.FS("readFile","output.mp4"),a=URL.createObjectURL(new Blob([s.buffer],{type:"video/mp4"}));tt.href=a,ee.setAttribute("aria-disabled","false")});se.addEventListener("click",o=>{W.stop(),T.stop()});ce.addEventListener("click",()=>{ne?(M.pause(),x.pause(),ne=!1):(M.currentTime=0,x.currentTime=0,M.play(),x.play(),ne=!0)});ot();
